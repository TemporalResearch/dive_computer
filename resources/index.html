<html>
<head>
    <title>Dive Computer</title>

    <script>
        function console_log(val) {
            console.log(val);
        }
    </script>
    <script type="module">
        import init, {initialise, run_iteration} from "./src/web_dive_computer.js"

        var simulationId = NaN;

        function play_real_time() {
            document.getElementById("time_at_depth").value = 0.1;
            document.getElementById("time_at_depth").disabled = true;
            document.getElementById("exe_sim").disabled = true;

            simulationId = setInterval(run_iteration, 100);
        }

        function pause_real_time() {
            document.getElementById("time_at_depth").value = 0;
            document.getElementById("time_at_depth").disabled = false;
            document.getElementById("exe_sim").disabled = false;

            if (!isNaN(simulationId)) {
                clearInterval(simulationId);
            }
        }

        function update_depth_slider() {
            let depth = document.getElementById("depth_slider").value;
            document.getElementById("depth_slider_val")
                .innerText = depth;
        }

        init().then(() => {
            initialise();

            document.getElementById("exe_sim")
                .addEventListener("click", run_iteration);
            document.getElementById("play_button")
                .addEventListener("click", play_real_time);
            document.getElementById("pause_button")
                .addEventListener("click", pause_real_time);
            document.getElementById("depth_slider")
                .addEventListener("input", update_depth_slider);
        })
    </script>

    <style>
        input[type=range] {
            writing-mode: vertical-lr;
        }
    </style>
</head>
<body>
<p>
    <b>WARNING: </b> Do not use for real world diving, this computer is experimental and has not been tested for safety.
</p>
<h1>Dive Computer</h1>

<input type="range" min="0" max="200" value="0" id="depth_slider"/><label id="depth_slider_val">0</label>ft<label> : Depth (feet)</label><br/>
<input type="number" id="time_at_depth"/><label> : Time at Depth (minutes)</label><br/>
<input type="button" id="exe_sim" value="simulate!"/><br/>
<input type="button" id="play_button" value="play"/><label>Real time sim (1 second represents 1 minute)</label><br/>
<input type="button" id="pause_button" value="pause"/><label>Pause real time sim</label><br/>

<p>Limiting Compartment: <b id="chosen_compartment"></b></p>
<p>Depth ceiling: <b id="chosen_compartment_depth_ceiling"></b></p>

<p>Current Depth: <b><span id="current_depth"></span>ft</b></p>

<div id="compartment_graph"></div>
<img src="compartment_display.svg"/>

</body>
</html>