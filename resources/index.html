<html>
<head>
    <title>Dive Computer</title>

    <script>
        function console_log(val) {
            console.log(val);
        }
    </script>
    <script type="module">
        import init, {initialise, run_iteration} from "./src/web_dive_computer.js"

        var simulationId = NaN;

        function play_real_time() {
            document.getElementById("time_at_depth").value = 0.1;
            document.getElementById("time_at_depth").disabled = true;
            document.getElementById("exe_sim").disabled = true;

            simulationId = setInterval(run_iteration, 100);
        }

        function pause_real_time() {
            document.getElementById("time_at_depth").value = 0;
            document.getElementById("time_at_depth").disabled = false;
            document.getElementById("exe_sim").disabled = false;

            if (!isNaN(simulationId)) {
                clearInterval(simulationId);
            }
        }

        function update_depth_slider() {
            let depth = document.getElementById("depth_slider").value;
            document.getElementById("depth_slider_val")
                .innerText = depth;
        }

        init().then(() => {
            initialise();

            document.getElementById("exe_sim")
                .addEventListener("click", run_iteration);
            document.getElementById("play_button")
                .addEventListener("click", play_real_time);
            document.getElementById("pause_button")
                .addEventListener("click", pause_real_time);
            document.getElementById("depth_slider")
                .addEventListener("input", update_depth_slider);
        })
    </script>

    <style>
        body {
            background-color: black;
            color: #CCCCCC;
            font-family: 'Courier New', monospace;
            margin: 10px;
            font-size: 12px;
        }

        h1 {
            color: #30BB30;
            text-align: center;
            border: 2px ridge #333333;
            padding: 8px;
            background-color: #111111;
            margin: 5px 0;
            font-size: 18px;
            font-family: 'Times New Roman', Times, serif;
        }

        p {
            margin: 3px 0;
            padding: 3px;
        }

        p:first-of-type {
            background-color: #1a0000;
            border: 2px solid #660000;
            color: #ffcccc;
            padding: 5px;
            text-align: center;
            font-size: 11px;
        }

        label {
            color: #CCCCCC;
        }

        #depth_slider_val {
            color: #30BB30;
            font-weight: bold;
            font-size: 14px;
            display: inline-block;
            text-align: center;
            min-width: 30px;
        }

        input[type=range] {
            writing-mode: vertical-lr;
            display: block;
            margin: 0 auto;
        }

        input[type=number] {
            background-color: #111111;
            color: #CCCCCC;
            border: 2px solid #30BB30;
            padding: 2px;
            font-family: 'Courier New', monospace;
            width: 180px;
        }

        input[type=number]:disabled {
            background-color: #0a0a0a;
            color: #666666;
            border-color: #222222;
        }

        input[type=button] {
            background-color: #1a4d1a;
            color: #CCCCCC;
            border: 2px outset #30BB30;
            padding: 4px 12px;
            margin: 2px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            font-size: 11px;
            width: 180px;
        }

        input[type=button]:hover {
            background-color: #30BB30;
            color: white;
        }

        input[type=button]:active {
            border-style: inset;
        }

        input[type=button]:disabled {
            background-color: #1a1a1a;
            color: #555555;
            border-color: #333333;
            cursor: not-allowed;
        }

        /*#exe_sim {*/
        /*    background-color: #1a3d5c;*/
        /*    border-color: #72bcfc;*/
        /*}*/

        /*#exe_sim:hover {*/
        /*    background-color: #30BB30;*/
        /*    color: white;*/
        /*}*/

        b {
            color: #30BB30;
        }

        table {
            margin: 5px 0;
        }

        td {
            vertical-align: middle;
        }

        #compartment_graph {
            border: 2px solid #333333;
            padding: 5px;
            margin: 10px 10px 10px 0;
            background-color: white;
            display: inline-block;
            vertical-align: top;
            width: 1210px;
            height: auto;
            overflow: visible;
        }

        img {
            border: 2px solid #333333;
            padding: 5px;
            background-color: white;
            vertical-align: top;
            height: auto;
            margin: 10px 10px 10px 0;
        }

        img.logo {
            border: none;
            padding: 0;
            background-color: black;
            vertical-align: bottom;
        }

        .head {
            background: black;
        }
    </style>
</head>
<body>
<p>
    <b>WARNING: </b> Do not use for real world diving, this computer is experimental and has not been tested for safety.
</p>
<h1>Dive Computer</h1>

<table cellpadding="3" cellspacing="0">
    <tr>
        <td style="text-align: center;">
            <input type="range" min="0" max="200" value="0" id="depth_slider"/>
            <div><label id="depth_slider_val">0</label>ft</div>
        </td>
        <td><label>: Depth (feet)</label></td>
    </tr>
    <tr>
        <td><input type="number" id="time_at_depth"/></td>
        <td><label>: Time at Depth (minutes)</label></td>
    </tr>
    <tr>
        <td><input type="button" id="exe_sim" value="simulate!"/></td>
        <td></td>
    </tr>
    <tr>
        <td><input type="button" id="play_button" value="play"/></td>
        <td><label>: Real time sim (1 second represents 1 minute)</label></td>
    </tr>
    <tr>
        <td><input type="button" id="pause_button" value="pause"/></td>
        <td><label>: Pause real time sim</label></td>
    </tr>
</table>

<p>Limiting Compartment: <b id="chosen_compartment"></b></p>
<p>Depth ceiling: <b id="chosen_compartment_depth_ceiling"></b></p>

<p>Current Depth: <b><span id="current_depth"></span>ft</b></p>

<div id="compartment_graph"></div>
<img src="compartment_display.svg"/>

    <span class="foot">
        <a href="https://colorcorp.io"><img class="logo" src="https://colorcorp.io/logo.svg" width="100px"/></a>
    </span>

</body>
</html>